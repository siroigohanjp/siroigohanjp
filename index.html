<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>スマログ</title>
  <style>
    :root{--cell:22px} /* マップのセルサイズ */
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      margin:0;
      background:#0f172a;
      color:#e6eef8
    }
    
    header{
      padding:12px 16px;
      background:#0b1220;
      box-shadow:0 2px 8px rgba(0,0,0,.6);
      display:flex;
      align-items:center;
      gap:12px
    }
    
    h1{margin:0;font-size:18px}
    #game{display:flex;gap:12px;padding:12px}
    #leftCol{position:relative}
    #status{
      position:absolute;
      left:-220px;top:0;
      width:200px;
      background:#071029;
      border:1px solid rgba(255,255,255,.04);
      padding:10px;border-radius:8px
    }
    
    #status h3{margin:0 0 8px 0;font-size:14px}
    #grid{
      display:grid;
      grid-template-columns:repeat(10,var(--cell));
      grid-template-rows:repeat(10,var(--cell));
      gap:2px;
      background:#081426;
      padding:8px;
      border-radius:8px
    }
    
    .cell{width:var(--cell);height:var(--cell);display:flex;align-items:center;justify-content:center;font-size:10px;border-radius:4px}
    .floor{background:linear-gradient(180deg,#0b1630,#071428)}
    .wall{background:linear-gradient(180deg,#4b5563,#111827);box-shadow:inset 0 -6px 10px rgba(0,0,0,.6)}
    .player{background:linear-gradient(180deg,#154c8a,#0b3a6b);color:#fff}
    .monster{background:linear-gradient(180deg,#7b1f1f,#4b0f0f);color:#fff}
    .empty{background:transparent}
    #controls{display:flex;flex-direction:column;gap:6px;align-items:center;margin-top:12px}
    .row{display:flex;gap:6px}
    button{
      background:#0b1220;
      border:1px solid rgba(255,255,255,.05);
      color:#dfeeff;
      padding:10px 10px;
      border-radius:6px;
      cursor:pointer
    }
    
    button.big{padding:12px 16px}
    #footer{padding:12px;text-align:center;color:#98a0b3}
    /* battle panel */
    #battle{
      position:fixed;
      left:50%;top:50%;
      transform:translate(-50%,-50%);
      background:#041028;
      padding:14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.04);
      display:none;z-index:40;
      width:320px
    }
    
    #battle h3{margin:0 0 8px 0}
    /* log 下に移動 */
    #log{
      margin-top:12px;
      width:300px;
      height:50px;
      background:#071029;
      border:1px solid rgba(255,255,255,.04);
      padding:10px;
      border-radius:8px;
      overflow:auto
    }
    
  </style>
</head>
<body>
  <header>
    <h1>スマログ — s r</h1>
    <div style="margin-left:auto;font-size:13px;color:#9fb2d6">V0.0.3</div>
  </header>

  <div id="game">
    <div id="leftCol">
      <div id="status">
        <h3>ステータス</h3>
        <div id="statusContent"></div>
        <div style="margin-top:8px"><button id="restart">再生成 (地図/モンスター)</button></div>
      </div>

      <div id="grid" aria-label="マップ"></div>

      <div id="controls">
        <div class="row"><button data-dir="up" class="big">↑</button></div>
        <div class="row"><button data-dir="left">←</button><button data-dir="down">↓</button><button data-dir="right">→</button></div>
      </div>

      <!-- ▼ログを操作ボタンの下に配置 -->
      <div id="log" aria-live="polite">

        <div id="logContent" style="margin-top:8px;font-size:13px"></div>
      </div>
    </div>
  </div>

  <div id="battle">
    <h3>戦闘</h3>
    <div id="battleInfo"></div>
    <div style="margin-top:8px">
      <button id="attackBtn">たたかう</button>
      <button id="fleeBtn">にげる</button>
    </div>
  </div>

  <div id="footer">SiroiGohanGame</div>

<script>
const gridEl = document.getElementById("grid");
const logEl = document.getElementById("logContent");
const statusEl = document.getElementById("statusContent");
const battleEl = document.getElementById("battle");
const battleInfo = document.getElementById("battleInfo");

const size = 10;
let player = {x:0,y:0,hp:20,atk:5};
let monsters = [];
let map = [];

// ログ出力
function log(msg){
  const p=document.createElement("div");
  p.textContent=msg;
  logEl.appendChild(p);
  logEl.scrollTop=logEl.scrollHeight;
}

// マップ生成
function generateMap(){
  map=[];
  for(let y=0;y<size;y++){
    let row=[];
    for(let x=0;x<size;x++){
      if(Math.random()<0.2) row.push("wall");
      else row.push("floor");
    }
    
    map.push(row);
  }
  
  // プレイヤー初期位置確保
  player.x=0;player.y=0;
  map[player.y][player.x]="floor";
  monsters=[];
  // モンスター配置
  for(let i=0;i<5;i++){
    let mx,my;
    do{
      mx=Math.floor(Math.random()*size);
      my=Math.floor(Math.random()*size);
    }while((mx==0&&my==0)||map[my][mx]==="wall");
    monsters.push({x:mx,y:my,hp:10,atk:3});
  }
  
  render();
  updateStatus();
  log("新しいマップが生成された！");
}

// 描画
function render(){
  gridEl.innerHTML="";
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const cell=document.createElement("div");
      cell.className="cell "+map[y][x];
      const m=monsters.find(m=>m.x===x&&m.y===y&&m.hp>0);
      if(player.x===x&&player.y===y){cell.classList.add("player");cell.textContent="＠";}
      else if(m){cell.classList.add("monster");cell.textContent="M";}
      gridEl.appendChild(cell);
    }
  }
}

// ステータス更新
function updateStatus(){
  statusEl.innerHTML=`HP: ${player.hp}<br>ATK: ${player.atk}`;
}

// 移動
function move(dx,dy){
  const nx=player.x+dx, ny=player.y+dy;
  if(nx<0||ny<0||nx>=size||ny>=size) return;
  if(map[ny][nx]==="wall") return;
  const m=monsters.find(m=>m.x===nx&&m.y===ny&&m.hp>0);
  if(m){ startBattle(m); return; }
  player.x=nx;player.y=ny;
  render();
}

// 戦闘開始
let currentEnemy=null;
function startBattle(enemy){
  currentEnemy=enemy;
  battleEl.style.display="block";
  battleInfo.textContent=`モンスター出現！ HP:${enemy.hp} ATK:${enemy.atk}`;
}

// 攻撃
document.getElementById("attackBtn").onclick=()=>{
  if(!currentEnemy) return;
  currentEnemy.hp-=player.atk;
  log(`プレイヤーの攻撃！ 敵に${player.atk}ダメージ`);
  if(currentEnemy.hp<=0){
    log("モンスターを倒した！");
    battleEl.style.display="none";
    render();
    return;
  }
  
  player.hp-=currentEnemy.atk;
  log(`敵の反撃！ プレイヤーは${currentEnemy.atk}ダメージを受けた`);
  if(player.hp<=0){ log("ゲームオーバー…"); }
  updateStatus();
  battleInfo.textContent=`モンスター HP:${currentEnemy.hp} ATK:${currentEnemy.atk}`;
};

// 逃げる
document.getElementById("fleeBtn").onclick=()=>{
  log("プレイヤーは逃げ出した！");
  battleEl.style.display="none";
  currentEnemy=null;
  render();
};

// ボタン操作
document.querySelectorAll("#controls button").forEach(btn=>{
  btn.onclick=()=>{
    const dir=btn.dataset.dir;
    if(dir==="up")move(0,-1);
    if(dir==="down")move(0,1);
    if(dir==="left")move(-1,0);
    if(dir==="right")move(1,0);
  }
});

// キーボード操作
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp")move(0,-1);
  if(e.key==="ArrowDown")move(0,1);
  if(e.key==="ArrowLeft")move(-1,0);
  if(e.key==="ArrowRight")move(1,0);
});

// 再生成
document.getElementById("restart").onclick=generateMap;

generateMap();
</script>
</body>
</html>
